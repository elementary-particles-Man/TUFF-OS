#!/bin/sh
# TF-Core Early Init Script (PID 1 Candidate)

# 1. Mount essential filesystems
/bin/mount -t proc proc /proc
/bin/mount -t sysfs sysfs /sys
/bin/mount -t devtmpfs devtmpfs /dev
/bin/mkdir -p /dev/pts
/bin/mount -t devpts devpts /dev/pts

# 2. Start Udev (for USB Hotplug)
echo "[TF-Core] Starting Device Manager..."
/sbin/udevd --daemon
/sbin/udevadm trigger
/sbin/udevadm settle

# 3. Handover to tuffd
if [ -x /bin/tuffd ]; then
    echo "[TF-Core] Handing over control to tuffd..."
    exec /bin/tuffd
else
    echo "[PANIC] /bin/tuffd not found! Dropping to shell."
    exec /bin/sh
fi
